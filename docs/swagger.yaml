definitions:
  api.APIError:
    properties:
      message:
        type: string
    type: object
  api.AdminCreateUserRequest:
    properties:
      password:
        type: string
      username:
        type: string
    type: object
  api.AdminResetPasswordRequest:
    properties:
      new_password:
        type: string
    type: object
  api.AdminTokenItem:
    properties:
      expires_at:
        type: string
      idle_timeout_seconds:
        type: integer
      issued_at:
        type: string
      jti:
        type: string
      last_seen_at:
        type: string
      name:
        type: string
      revoked_at:
        type: string
      revoked_by:
        type: integer
      type:
        $ref: '#/definitions/models.TokenType'
      user_id:
        type: integer
      username:
        type: string
    type: object
  api.AdminUserItem:
    properties:
      created_at:
        type: string
      id:
        type: integer
      is_root:
        type: boolean
      updated_at:
        type: string
      username:
        type: string
    type: object
  api.AuditLogItem:
    properties:
      action:
        type: string
      created_at:
        type: string
      detail:
        type: string
      id:
        type: integer
      ip:
        type: string
      method:
        type: string
      path:
        type: string
      resource:
        type: string
      user_agent:
        type: string
      user_id:
        type: integer
      username:
        type: string
    type: object
  api.AuditLogPage:
    properties:
      items:
        items:
          $ref: '#/definitions/api.AuditLogItem'
        type: array
      page:
        type: integer
      size:
        type: integer
      total:
        type: integer
    type: object
  api.ChangePasswordRequest:
    properties:
      new_password:
        type: string
      old_password:
        type: string
    type: object
  api.CreateAPITokenRequest:
    properties:
      name:
        type: string
      password:
        type: string
      username:
        type: string
    type: object
  api.CreateAPITokenResponse:
    properties:
      jti:
        type: string
      name:
        type: string
      token:
        type: string
      type:
        type: string
    type: object
  api.CreateMyTokenRequest:
    properties:
      name:
        type: string
    type: object
  api.CreateSettingRequest:
    type: object
  api.LoginWebRequest:
    properties:
      password:
        type: string
      username:
        type: string
    type: object
  api.LoginWebResponse:
    properties:
      idle_timeout_seconds:
        type: integer
      jti:
        type: string
      token:
        type: string
      type:
        type: string
    type: object
  api.SessionItem:
    properties:
      idle_timeout_seconds:
        type: integer
      issued_at:
        type: string
      jti:
        type: string
      last_seen_at:
        type: string
      revoked_at:
        type: string
      user_id:
        type: integer
      username:
        type: string
    type: object
  api.TokenInfo:
    properties:
      expires_at:
        type: string
      idle_timeout_seconds:
        type: integer
      issued_at:
        type: string
      jti:
        type: string
      last_seen_at:
        type: string
      name:
        type: string
      revoked_at:
        type: string
      type:
        $ref: '#/definitions/models.TokenType'
    type: object
  api.UpdateSettingRequest:
    type: object
  api.UpsertSettingByNameRequest:
    type: object
  models.Setting:
    properties:
      created_at:
        type: string
      id:
        description: |-
          UUID string primary key
          UUID 字符串主键
        type: string
      name:
        description: |-
          Unique key name
          唯一配置名
        type: string
      updated_at:
        type: string
      value:
        description: |-
          ValueJSON 存放 JSON 原始值（number/string/bool）
          Swagger 用 string 展示，实际请求可传 10 / "abc" / true
        example: "true"
        type: string
      value_type:
        description: |-
          Discriminator for value type: int|string|bool
          值类型判别字段：int|string|bool
        type: string
    type: object
  models.TokenType:
    enum:
    - web
    - api
    type: string
    x-enum-varnames:
    - TokenTypeWeb
    - TokenTypeAPI
  response.Envelope-any:
    properties:
      code:
        $ref: '#/definitions/response.ErrorCode'
      data: {}
      message:
        description: English message / 英文信息
        type: string
    type: object
  response.Envelope-api_AdminUserItem:
    properties:
      code:
        $ref: '#/definitions/response.ErrorCode'
      data:
        $ref: '#/definitions/api.AdminUserItem'
      message:
        description: English message / 英文信息
        type: string
    type: object
  response.Envelope-api_AuditLogPage:
    properties:
      code:
        $ref: '#/definitions/response.ErrorCode'
      data:
        $ref: '#/definitions/api.AuditLogPage'
      message:
        description: English message / 英文信息
        type: string
    type: object
  response.Envelope-api_CreateAPITokenResponse:
    properties:
      code:
        $ref: '#/definitions/response.ErrorCode'
      data:
        $ref: '#/definitions/api.CreateAPITokenResponse'
      message:
        description: English message / 英文信息
        type: string
    type: object
  response.Envelope-api_LoginWebResponse:
    properties:
      code:
        $ref: '#/definitions/response.ErrorCode'
      data:
        $ref: '#/definitions/api.LoginWebResponse'
      message:
        description: English message / 英文信息
        type: string
    type: object
  response.Envelope-array_api_AdminTokenItem:
    properties:
      code:
        $ref: '#/definitions/response.ErrorCode'
      data:
        items:
          $ref: '#/definitions/api.AdminTokenItem'
        type: array
      message:
        description: English message / 英文信息
        type: string
    type: object
  response.Envelope-array_api_AdminUserItem:
    properties:
      code:
        $ref: '#/definitions/response.ErrorCode'
      data:
        items:
          $ref: '#/definitions/api.AdminUserItem'
        type: array
      message:
        description: English message / 英文信息
        type: string
    type: object
  response.Envelope-array_api_SessionItem:
    properties:
      code:
        $ref: '#/definitions/response.ErrorCode'
      data:
        items:
          $ref: '#/definitions/api.SessionItem'
        type: array
      message:
        description: English message / 英文信息
        type: string
    type: object
  response.Envelope-array_api_TokenInfo:
    properties:
      code:
        $ref: '#/definitions/response.ErrorCode'
      data:
        items:
          $ref: '#/definitions/api.TokenInfo'
        type: array
      message:
        description: English message / 英文信息
        type: string
    type: object
  response.ErrorCode:
    enum:
    - 0
    - 10000
    - 10001
    - 10002
    - 10003
    - 10004
    - 10005
    type: integer
    x-enum-varnames:
    - CodeOK
    - CodeBadRequest
    - CodeUnauthorized
    - CodeForbidden
    - CodeNotFound
    - CodeConflict
    - CodeInternal
info:
  contact: {}
paths:
  /api/v1/admin/audit/logs:
    get:
      description: |-
        Root can query audit logs of all users with pagination and time range filter.
        root 用户可分页查询全部审计日志，并支持时间范围过滤。
      parameters:
      - default: 1
        description: page / 页码
        in: query
        name: page
        type: integer
      - default: 20
        description: page size / 每页数量
        in: query
        name: page_size
        type: integer
      - description: start time (RFC3339 or YYYY-MM-DD) / 开始时间
        in: query
        name: from
        type: string
      - description: end time (RFC3339 or YYYY-MM-DD) / 结束时间
        in: query
        name: to
        type: string
      - description: filter by user_id / 按用户ID过滤（可选）
        in: query
        name: user_id
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-api_AuditLogPage'
      security:
      - BearerAuth: []
      summary: List audit logs (admin) / 查询审计日志（管理员）
      tags:
      - audit
  /api/v1/admin/sessions:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-array_api_SessionItem'
      security:
      - BearerAuth: []
      summary: List all web sessions / 列出所有 Web 会话
      tags:
      - admin
  /api/v1/admin/sessions/{jti}:
    delete:
      parameters:
      - description: session jti / 会话标识
        in: path
        name: jti
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Kick a web session / 踢掉 Web 会话
      tags:
      - admin
  /api/v1/admin/tokens:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-array_api_AdminTokenItem'
      security:
      - BearerAuth: []
      summary: List all tokens / 列出所有 Token
      tags:
      - admin
  /api/v1/admin/tokens/{jti}:
    delete:
      parameters:
      - description: token jti / token 标识
        in: path
        name: jti
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Revoke token / 撤销 Token
      tags:
      - admin
  /api/v1/admin/users:
    get:
      description: |-
        Root user lists all users.
        root 用户查看所有用户。
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-array_api_AdminUserItem'
      security:
      - BearerAuth: []
      summary: List users / 列出用户
      tags:
      - admin
    post:
      consumes:
      - application/json
      description: |-
        Root creates a normal user.
        root 创建普通用户。
      parameters:
      - description: request / 请求
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/api.AdminCreateUserRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-api_AdminUserItem'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Create user / 创建用户
      tags:
      - admin
  /api/v1/admin/users/{id}:
    delete:
      description: |-
        Root deletes a user, but root itself is protected.
        root 删除用户，但 root 自身受保护不可删除。
      parameters:
      - description: user id / 用户ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-any'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Delete user / 删除用户
      tags:
      - admin
  /api/v1/admin/users/{id}/password:
    put:
      consumes:
      - application/json
      parameters:
      - description: user id / 用户ID
        in: path
        name: id
        required: true
        type: integer
      - description: request / 请求
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/api.AdminResetPasswordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Reset user password / 重置用户密码
      tags:
      - admin
  /api/v1/auth/login:
    post:
      consumes:
      - application/json
      description: |-
        Create a web session token with sliding idle timeout.
        创建带滑动空闲超时的 Web 会话 Token。
      parameters:
      - description: login request / 登录请求
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/api.LoginWebRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-api_LoginWebResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/response.Envelope-any'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/response.Envelope-any'
      summary: Web login / Web 登录
      tags:
      - auth
  /api/v1/auth/logout:
    post:
      description: |-
        Revoke current token (web session or api token).
        撤销当前 Token（Web 会话或 API Token）。
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-any'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Logout / 注销
      tags:
      - auth
  /api/v1/auth/token:
    post:
      consumes:
      - application/json
      description: |-
        Create a permanent API token for subsequent authenticated API calls.
        通过用户名密码创建永久 API Token，用于后续需要鉴权的 API。
      parameters:
      - description: request / 请求
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/api.CreateAPITokenRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-api_CreateAPITokenResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/response.Envelope-any'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/response.Envelope-any'
      summary: Create API token by password / 通过密码创建 API Token
      tags:
      - auth
  /api/v1/me/audit/logs:
    get:
      description: |-
        Normal user can only view their own audit logs.
        普通用户只能查看自己的审计日志。
      parameters:
      - default: 1
        description: page / 页码
        in: query
        name: page
        type: integer
      - default: 20
        description: page size / 每页数量
        in: query
        name: page_size
        type: integer
      - description: start time (RFC3339 or YYYY-MM-DD) / 开始时间
        in: query
        name: from
        type: string
      - description: end time (RFC3339 or YYYY-MM-DD) / 结束时间
        in: query
        name: to
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-api_AuditLogPage'
      security:
      - BearerAuth: []
      summary: List my audit logs / 查看我的审计日志
      tags:
      - audit
  /api/v1/me/password:
    put:
      consumes:
      - application/json
      description: |-
        User changes their own password by providing old_password and new_password.
        用户提供旧密码与新密码，自助修改密码。
      parameters:
      - description: request / 请求
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/api.ChangePasswordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-any'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/response.Envelope-any'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Change my password / 修改我的密码
      tags:
      - me
  /api/v1/me/sessions:
    get:
      description: |-
        List active web sessions (type=web, not revoked).
        列出有效 Web 会话（type=web 且未撤销）。
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-array_api_TokenInfo'
      security:
      - BearerAuth: []
      summary: List my web sessions / 列出我的 Web 会话
      tags:
      - me
  /api/v1/me/sessions/{jti}:
    delete:
      parameters:
      - description: session jti / 会话标识
        in: path
        name: jti
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-any'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Kick my session / 踢掉我的会话
      tags:
      - me
  /api/v1/me/tokens:
    delete:
      description: |-
        Self-service revoke all tokens without admin.
        普通用户自助撤销自己所有 Token（不走管理员）。
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Revoke all my tokens / 撤销我所有 Token
      tags:
      - me
    get:
      description: |-
        List tokens (web sessions + api tokens) of current user.
        列出当前用户的 Token（Web 会话 + API Token）。
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-array_api_TokenInfo'
      security:
      - BearerAuth: []
      summary: List my tokens / 列出我的 Token
      tags:
      - me
    post:
      consumes:
      - application/json
      description: |-
        Create a permanent API token for the current user.
        为当前用户创建永久 API Token。
      parameters:
      - description: request / 请求
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/api.CreateMyTokenRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-api_CreateAPITokenResponse'
      security:
      - BearerAuth: []
      summary: Create my API token / 创建我的 API Token
      tags:
      - me
  /api/v1/me/tokens/{jti}:
    delete:
      parameters:
      - description: token jti / token 标识
        in: path
        name: jti
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Envelope-any'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/response.Envelope-any'
      security:
      - BearerAuth: []
      summary: Revoke my token / 撤销我的指定 Token
      tags:
      - me
  /api/v1/settings:
    get:
      description: List all settings
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/models.Setting'
            type: array
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/api.APIError'
      summary: List settings
      tags:
      - Setting
    post:
      consumes:
      - application/json
      parameters:
      - description: create setting
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/api.CreateSettingRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/models.Setting'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.APIError'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/api.APIError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/api.APIError'
      summary: Create setting
      tags:
      - Setting
  /api/v1/settings/{id}:
    delete:
      description: Delete a setting by UUID id.
      parameters:
      - description: setting id (uuid)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.APIError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/api.APIError'
      summary: Delete setting by id
      tags:
      - Setting
    get:
      description: Get a setting by UUID id.
      parameters:
      - description: setting id (uuid)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.Setting'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.APIError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/api.APIError'
      summary: Get setting by id
      tags:
      - Setting
    patch:
      consumes:
      - application/json
      parameters:
      - description: setting id (uuid)
        in: path
        name: id
        required: true
        type: string
      - description: update setting
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/api.UpdateSettingRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.Setting'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.APIError'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.APIError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/api.APIError'
      summary: Update setting by id
      tags:
      - Setting
  /api/v1/settings/by-name/{name}:
    get:
      description: Get a setting by unique name.
      parameters:
      - description: setting name
        in: path
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.Setting'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/api.APIError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/api.APIError'
      summary: Get setting by name
      tags:
      - Setting
    put:
      consumes:
      - application/json
      description: |-
        Create if missing; otherwise update value (and optionally value_type).
        value must match value_type: int|string|bool.
      parameters:
      - description: setting name
        in: path
        name: name
        required: true
        type: string
      - description: upsert payload
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/api.UpsertSettingByNameRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.Setting'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.APIError'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/api.APIError'
      summary: Upsert setting by name
      tags:
      - Setting
swagger: "2.0"
